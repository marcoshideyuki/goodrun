<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="CSS/header-logado.css">
    <link rel="stylesheet" href="CSS/dados.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.9/dist/chart.umd.min.js"></script>
</head>

<body>
    <header>
        <div class="logo">
            <img src="assets/Design sem nome.png">
            <div class="texto-logo">
                <h1>GOODRUN</h1>
                <p>Born to run</p>
            </div>
        </div>
        <ul>
            <li><a href="tela-logado.html">Home</a></li>
            <li><a href="calendario.html">Calendário</a></li>
            <li><a href="dados.html">Meu desempenho</a></li>
            <button class="botao-header" onclick="encerrarSessao()">Sair</button>
        </ul>
    </header>
    <main>
        <canvas id="myChartCanvas"></canvas>
    </main>
</body>

</html>
<script>
    
    window.onload = obterDadosGrafico()
    window.onload = plotarGrafico()
    
    function obterDadosGrafico() {
        var fk_usuario = sessionStorage.ID_USUARIO
        fetch(`/estatisticas/ultimas/${fk_usuario}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    resposta.reverse();
                    plotarGrafico(resposta);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }
    function plotarGrafico(resposta) {
        console.log('iniciando plotagem do gráfico...');
        // Criando estrutura para plotar gráfico - labels
        let labels = [];
        // Criando estrutura para plotar gráfico - dados
        let dados = {
            labels: labels,
            datasets: [{
                label: 'Pace',
                data: [],
                fill: false,
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            },
            ]
        };
        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)
        // Inserindo valores recebidos em estrutura para plotar o gráfico
        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            labels.push(registro.dataCorrida);
            dados.datasets[0].data.push(registro.pace);
        }
        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labels)
        console.log('Dados:')
        console.log(dados.datasets)
        console.log('----------------------------------------------')
        // Criando estrutura para plotar gráfico - config
        const config = {
            type: 'line',
            data: dados,
        };
        // Adicionando gráfico criado em div na tela
        let myChart = new Chart(
            document.getElementById(`myChartCanvas`),
            config
        );
    }


    // const grafico = document.getElementById('dash')

    // const data = {
    //     labels: ['Dia 1', 'Dia 2', 'Dia 3', 'Dia 4', 'Dia 5'],
    //     datasets: [{   
    //         label: "Pace",
    //         data: [4, 5, 5.3, 6, 5]
    //     }]
    // }

    // const corpo = new Chart (
    //     grafico,
    //     {
    //         type: 'line',
    //         data,
    //         options: {
    //             maintenAspectRatio: true
    //         }
    //     }
    // )

    function encerrarSessao() {
        sessionStorage.clear()
        window.location = "index.html"
    }
</script>